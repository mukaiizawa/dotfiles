世代管理のあるテーブルの設計について

# 概要
期間によって振舞いが異なるデータを世代管理対象のデータと呼ぶ。
世代管理対象のデータを扱うテーブルの設計について考える。

# 考察対象
考察にあたり、次のような具体的なエンティティを考える。
    商品(商品ID, 商品価格, ...)
商品は期間によって商品価格が変わり得ることとする。

# 世代管理方法について
いくつかのケースでどの手法を用いるとどうなるのかについて考察する。

## 有効開始日を複合キーにする
商品エンティティに次の複合キーを設定することにより実現可能。
    商品(商品ID, 有効開始日, 商品価格, ...)
    主キー{商品ID, 有効開始日}
この設計を用いる場合は次のような運用となる。
ある時点のある商品の商品価格を取得したい場合は次のようなSQLを使用することになる。
    SELECT 商品.商品価格
    FROM 商品
    WHERE
      商品ID = :ID
      有効開始日 = (
        SELECT MAX(商品.有効開始日)
        FROM 商品
        WHERE 商品.有効開始日 <= :DATE
      )
### 注意点
1. 本来は関連があるエンティティに外部キー制約を付与できない。
2. 後述する有効終了日を持たせる方法に比べSQLが若干複雑になる。
3. データの連続姓がない場合はこの手法が使用できない。
=> 任意の時点において対応する商品が存在する。

## 属性値に有効終了日を追加する
有効開始日を複合キーに設定した場合のSQLを簡略化するため、
新しく有効終了日を追加する。
    商品(商品ID, 有効開始日, 有効終了日, 商品価格, ...)
    主キー{商品ID, 有効開始日}
この場合、ある日時におけるある商品の商品価格は次のSQLで取得可能。
    SELECT 商品.商品価格
    FROM 商品
    WHERE :DATE BETWEEN 商品.有効開始日 AND 商品.有効終了日
これにより、副問い合わせを使用することなく結果を得ることができる。
### 注意点
1. 本来は関連があるエンティティに外部キー制約を付与できない。
2. データの連続性をプログラマが担保する必要がある。
3. 有効終了日が次の世代の有効開始日と同じ値を持つのかどうかで設計が変わる。

## サロゲートキーを用いて外部キー制約を付与できるようにする
サロゲートキーを設定することにより、外部キー制約を付与できるようにする。
修正後のエンティティは次のようになる。
    商品(商品SEQ, 商品ID, 有効開始日, 有効終了日, 商品価格, ...)
    主キー{商品SEQ}
これにより、商品エンティティと関連のあるエンティティは商品SEQを外部キー制約に設定できる。
### 注意点
1. 有効終了日は目的に応じていれても入れなくてもよい。
2. その他の手法の注意点による。
